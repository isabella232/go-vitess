package callinfo

import (
	"fmt"
	"html/template"

	"github.com/youtube/vitess/go/rpcwrap/proto"
	"golang.org/x/net/context"
)

// RPCWrapCallInfo takes a context generated by rpcwrap, and
// returns one that has CallInfo filled in.
func RPCWrapCallInfo(ctx context.Context) context.Context {
	remoteAddr, _ := proto.RemoteAddr(ctx)
	username, _ := proto.Username(ctx)
	return NewContext(ctx, &CallInfo{
		RemoteAddr: remoteAddr,
		Username:   username,
		Text:       fmt.Sprintf("%s@%s", username, remoteAddr),
		HTML:       template.HTML("<b>RemoteAddr:</b> " + remoteAddr + "</br>\n" + "<b>Username:</b> " + username + "</br>\n"),
	})
}
